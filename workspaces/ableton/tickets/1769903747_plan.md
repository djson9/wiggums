# Plan: Add Ableton Menu List Command
status: completed

## Ticket Summary
Add an `am ableton menu ls` command that lists menu items exposed by Ableton. This helps debug issues where menu item names differ from expectations (e.g., "Bounce Track in Place" vs "Bounce Group in Place").

## Implementation Approach

### 1. Create new command structure
- Add `ableton` parent command
- Add `ableton menu` subcommand group
- Add `ableton menu ls` command that lists menu items
- Optional: `am ableton menu ls <menu-name>` to list items under a specific menu (e.g., Edit)

### 2. Handler Implementation
Uses AppleScript to query Ableton's menu bar structure via System Events.

### 3. Output Format (JSON)
```json
{
  "success": true,
  "menu": {
    "name": "Edit",
    "items": [
      {"name": "Bounce Track in Place", "enabled": true},
      {"name": "Bounce Group in Place", "enabled": true}
    ]
  }
}
```

## Files Created
- `ableton-manager-cli/cmd/ableton.go` - New parent command with menu subcommands
- `ableton-manager-cli/handlers/ableton.go` - Handler with AppleScript logic

---

### Commands Run / Actions Taken

1. Created `ableton-manager-cli/handlers/ableton.go` with:
   - `ListAbletonMenus(menuName string)` function
   - AppleScript to query System Events for Ableton menu structure
   - Parsing logic for menu item names and enabled states

2. Created `ableton-manager-cli/cmd/ableton.go` with:
   - `am ableton` parent command
   - `am ableton menu` subcommand
   - `am ableton menu ls [menu-name]` command

3. Built project with `make build`
4. Tested commands

### Results

**Successfully implemented the `am ableton menu ls` command:**

- `am ableton menu ls` - Lists all top-level menus (Apple, Live, File, Edit, Create, Playback, View, Navigate, Options, Help)
- `am ableton menu ls <menu-name>` - Lists all items in a specific menu with their enabled state

**Verified the original use case:**
- When a regular track is selected: "Bounce Track in Place" appears
- When a group track is selected: "Bounce Group in Place" appears

### Verification Commands / Steps

1. List all menus:
   ```bash
   am ableton menu ls
   # Returns: Apple, Live, File, Edit, Create, Playback, View, Navigate, Options, Help
   ```

2. List Edit menu items:
   ```bash
   am ableton menu ls Edit
   # Returns all Edit menu items with enabled state
   ```

3. Filter for bounce-related items:
   ```bash
   am ableton menu ls Edit | jq '.menu.items[] | select(.name | contains("Bounce"))'
   ```

4. Verified menu item names change based on track selection:
   - Selected regular track: Shows "Bounce Track in Place"
   - Selected group track via `am focus <group-uuid>`: Shows "Bounce Group in Place"

5. Tests pass: `make test`

**Verification completed: 100%**

All functionality verified end-to-end:
- [x] Command structure works (`am ableton menu ls`)
- [x] Top-level menu listing works
- [x] Specific menu item listing works
- [x] Enabled state is correctly reported
- [x] Can filter for bounce-related items
- [x] Verified the original bug context (track vs group bounce menu names)
- [x] Tests pass
